# 援力白皮书

## 版本

v0.01

> v1.0之前为中心化验证的预览版

## 时间

2018年6月15日公开本标准。

2018年6月18日00:00实行，之前的临时标准不再被承认。

## 字符集

UTF-8

## 哈希值计算方法

```ruby
hash = sha512(cheer_word + address + code + unix_time + love_power)
```

cheer_word: 许愿用的应援词，会显示在网页上。

address: 钱包地址

code: 股票代码

unix_time: 哈希值产生时的unix时间，精确到秒。

love_power: int64随机数

## 难度同步接口

Method: GET

URL: https://www.yuanlimm.com/api/super_wishs

Format: JSON

```js
{
    "hard":28 // 当前难度
}
```

## 哈希值验证办法

首先将上面得到的哈希值转换为512位的二进制值

如果通过上面的API获取的难度为28,那么这个二进制值的末尾需要有28个连续0。

```ruby
# 例子，末尾有28个连续0
11011101001110111101111110000010000011010100010101011100010001001100100100000
01011001010010011011111111100010001010001110011111110001000011001000111001000
01000011010111010101001100101001011110011110100100010010010010111010011011100
00011011111101001011010000001000101111000010010001101111011010010010010100110
11001000110001111111111001101100101011101000010000001011100101100100101111100
01111101100110100000101011001000011110101101011000111111010111110010110001010
10000000011101010111110000000000000000000000000000
```

## 提交成果

Method: POST

URL: https://www.yuanlimm.com/api/super_wishs

Format: JSON

```js
{
  "cheer_word": "我永远喜欢英梨梨", //许愿词
  "address": "GkcBo4HtXqYeM4uK3FHjgoCJ62dkwLg2" //钱包地址，在https://www.yuanlimm.com/#/profile
  "code": "ERIRI" //股票代码
  "unix_time": 1529046484, //哈希值产生的时间，精确到秒。如果这个时间和服务器当前的时间偏差超过30分钟，则拒绝。
  "love_power": 123456 //随机数
}
```

## 关于难度

系统的设定值是一秒钟100次许愿成功，当超过这个次数就会相应的调整难度。

如果这三十分钟的许愿成功次数大于```30 * 100 = 3000次```那么难度加1，反之难度-1。

难度会在每小时的第一分钟内和每小时的第三十分钟内更新，也就是每半小时更新一次。

## 关于时间

unix_time, 哈希值产生的时间。如果这个时间和服务器当前的时间偏差超过30分钟，则拒绝。

## API限制

本站是小站，个人零花钱运维，之前因为心跳包过于频繁导致费用高昂。

在难度和时间的要求调整后，难度不会频繁变化，时间对准也没之前苛刻，所以限制API调用次数。

单个IP每分钟可以调用一次```难度同步接口```, 单个IP每分钟最多可以调用30次```提交成果```接口。

谢谢各位的理解和支持。
